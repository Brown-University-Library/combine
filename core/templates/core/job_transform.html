{% extends 'core/base.html' %}

{% block content %}

	<style type="text/css">
		
		.draggable_button {
			margin-top: 2px;
			margin-bottom: 2px;
		}

		.draggable_ul {
			min-height: 75px;
			border-radius: 4px;
			padding-top: 10px;
			padding-bottom: 10px;
			list-style-type: none;
			cursor: move;
			background-color:#f5f5f5;
		}

		.draggable_ul button {
			cursor: move;
		}

		.ph-class {
			border: 1px solid #343a40;
		}

	</style>

	<div class="row">
		<div class="col-md-12">
			<h3>New Job: <span class="font-weight-bold">Transform Document</span></h3>
		</div>
	</div>

	<div class="row">
		<div class="col-md-12">
			<form id="job_init_form" method="POST" action="{% url 'job_transform' org_id=record_group.organization.id record_group_id=record_group.id %}">

				{% csrf_token %}
	
				<div class="row">
					<div class="col-md-12">
						<!-- optional job details -->
						{% include 'core/job_optional_details.html' %}
					</div>
				</div>

				<div class="row">
					<div class="col-md-12">
						{% if input_job_scope == None %}
							<div class="alert alert-info alert-dismissible fade show" role="alert">
								Showing Jobs from <span class="font-weight-bold">Record Group only</span>.  <a href="{% url 'job_transform' org_id=record_group.organization.id record_group_id=record_group.id %}?scope=all_jobs">Click here to show Jobs from <span class="font-weight-bold">all Record Groups</span>.</a>
								<button type="button" class="close" data-dismiss="alert" aria-label="Close">
								<span aria-hidden="true">&times;</span>
								</button>
							</div>
						{% else %}
							<div class="alert alert-info alert-dismissible fade show" role="alert">
								Showing Jobs from <span class="font-weight-bold">All Record Groups</span>.  <a href="{% url 'job_transform' org_id=record_group.organization.id record_group_id=record_group.id %}">Click here to show Jobs from <span class="font-weight-bold">this Record Group only</span>.</a>
								<button type="button" class="close" data-dismiss="alert" aria-label="Close">
								<span aria-hidden="true">&times;</span>
								</button>
							</div>
						{% endif %}
						<div class="alert alert-danger alert-dismissible fade show" role="alert">
							<strong>Transform</strong> Jobs require a single, or multiple, <strong>input Job(s)</strong>.  Select from the table below.
							<button type="button" class="close" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<!-- Job Select -->
						{% include 'core/job_input_select.html' %}
					</div>
				</div>

				<div class="row">
					<div class="col-md-12">
						<div class="alert alert-danger alert-dismissible fade show" role="alert">
							The following are <strong>required</strong> parameters for this Job
							<button type="button" class="close" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
							</button>
						</div>

						<!-- single transformation selection -->
						<!-- <div class="form-group">
							<label for="transformation_id">Select Transformation Scenario to use</label>
							<select class="form-control" id="transformation_id" name="transformation_id" required>
								{% for transformation in transformations %}
									<option value="{{ transformation.id }}">{{ transformation.name }} ({{ transformation.transformation_type }})</option>	
								{% endfor %}						
							</select>
						</div> -->

						<!-- multiple, sortable transformations -->
						<div class="row">
							<div class="col-md-12">
								<p>Use the tables below to select, and order, Transformation Scenarios that will be applied.  First, <strong>drag</strong> Transformations from the table on the left to the table on the right.  Second, <strong>order</strong> the Transformation in the order they should be applied.</p>
							</div>
						</div>
						<div class="row">

							<div class="col-md-6">
								<h5>Available Transformation Scenarios</h5>
								<ul class="draggable_ul available_transforms">
									{% for transformation in transformations %}
										<li data-trans_id={{transformation.id}} ><button class="draggable_button btn-outline-dark btn-sm">{{transformation.name}}</button></li>									
									{% endfor %}
								</ul>
							</div>

							<div class="col-md-6">
								<h5>Selected Transformation Scenarios</h5>
								<ul class="draggable_ul selected_transforms">
								</ul>
							</div>

						</div>
						<script>

							// init available transforms
							var available = sortable('.available_transforms', {								
								acceptFrom: ".selected_transforms, .available_transforms",								
								items:'li',
								forcePlaceholderSize: true,
								placeholderClass: 'ph-class', 								
							});

							// init selected transforms
							var selected = sortable('.selected_transforms', {								
								acceptFrom: ".available_transforms, .selected_transforms",								
								items:'li',
								forcePlaceholderSize: true,
								placeholderClass: 'ph-class', 
							});

						</script>

					</div>
				</div>

				<!-- Optional Job Processing -->
				{% include 'core/job_optional_processing.html' %}
				
				<button type="submit" class="btn btn-success btn-sm">Run Transform Job <i class="la la-play"></i></button>

			</form>

			<!-- Modals -->
			{% include 'core/job_spec_input_filters.html' %}
			
		</div>
	</div>

{% endblock %}