{% extends 'core/base.html' %}

{% block content %}

	<div>
		<h3>Record Group: {{ record_group.name }}</h3>

		<table border="1" cellpadding="10">
			<tr>
				<th>Description</th>
				<td>{{ record_group.description }}</td>
			</tr>
			<tr>
				<th>Published Records</th>
				{% if record_group.jobpublish_set.all|length > 0 %}
					<td class="{{ record_group.jobpublish_set.all.first.job.job_type_family }}"><a href="{% url 'job_details' org_id=record_group.organization.id record_group_id=record_group.id job_id=record_group.jobpublish_set.all.first.job.id %}">{{ record_group.jobpublish_set.all.first.job.name }}, Job #{{ record_group.jobpublish_set.all.first.job.id }}</a></td>
				{% else %}
					<td style="color:red;">None</td>
				{% endif %}
			</tr>
			<tr>
				<th>Published Set ID</th>
				<td>{{ record_group.publish_set_id }}</td>
			</tr>
		</table>
	</div>

	<div>		
		<h3>Jobs</h3>

		<div id="job_family_diagram_container">
			<style type="text/css">
				#job_family_diagram {
					width: 100%;
					height: 400px;
					border: 1px solid lightgray;
				}
			</style>
			<div id="job_family_diagram"></div>
			<script type="text/javascript">
			  // create an array with nodes
			  var nodes = new vis.DataSet([
			    {id: 1, label: 'HarvestOAIJob @ 2018-01-12T14:42:03.972745', physics:false, shape:'square'},
			    {id: 2, label: 'HarvestOAIJob @ 2018-01-12T14:42:32.528530', physics:false, shape:'square'},

			    {id: 3, label: 'TransformJob @ 2018-01-12T14:42:17.094038', physics:true, shape:'square'},			    
			    {id: 4, label: 'TransformJob @ 2018-01-12T14:42:38.745433', physics:true, shape:'square'},
			    {id: 5, label: 'TransformJob @ 2018-01-12T14:42:53.535002', physics:true, shape:'square'},
			    {id: 6, label: 'TransformJob @ 2018-01-12T14:58:18.037973', physics:true, shape:'square'}
			  ]);

			  // create an array with edges
			  var edges = new vis.DataSet([
			    {from: 1, to: 3},			    
			    {from: 2, to: 4},
			    {from: 4, to: 5},
			    {from: 2, to: 6},
			  ]);

			  // create a network
			  var container = document.getElementById('job_family_diagram');
			  var data = {
			    nodes: nodes,
			    edges: edges
			  };
			  var options = {
			  	interaction:{
		  		  zoomView:false	
			  	},
			  	layout:{
				  	hierarchical: {
				      enabled:true,
				      levelSeparation: 300,
				      nodeSpacing: 400,
				      treeSpacing: 200,
				      blockShifting: true,
				      edgeMinimization: true,
				      parentCentralization: true,
				      direction: 'LR',        // UD, DU, LR, RL
				      sortMethod: 'directed'   // hubsize, directed
				    }
			  	}			  	
			  };
			  var network = new vis.Network(container, data, options);
			</script>
		</div>

		<div>
			<!-- job datatable -->
			{% include 'core/jobs_dt_table.html' %}
		</div>
		
	</div>

	<div>
		<h3>Run new job</h3>
		<p>
			<ul>
				<li>Harvest:
					<ul>
						<li><a href="{% url 'job_harvest_oai' org_id=record_group.organization.id record_group_id=record_group.id %}">OAI-PMH</a></li>
						<li><a href="{% url 'job_harvest_static_xml' org_id=record_group.organization.id record_group_id=record_group.id %}">Static XML</a></li>
					</ul>
				</li>
				<li><a href="{% url 'job_transform' org_id=record_group.organization.id record_group_id=record_group.id %}">Transform</a></li>
				<li><a href="{% url 'job_merge' org_id=record_group.organization.id record_group_id=record_group.id %}">Merge</a></li>
				<li><a href="{% url 'job_publish' org_id=record_group.organization.id record_group_id=record_group.id %}">Publish</a></li>
			</ul>
		</p>
	</div>

{% endblock %}