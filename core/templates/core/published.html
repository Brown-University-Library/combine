{% extends 'core/base.html' %}

{% block content %}

<h2>Published Sets</h2>

<table border="1" cellpadding="10">

	<tr>
		<th>Set ID</th>
		<th>Record Group</th>
		<th>Published Records</th>
		<th>Record Count</th>
	</tr>

	{% for set, jobs in published.sets.items %}
		{% for job in jobs %}
			<tr>
				<td>"{{ set }}"</td>
				<td>{{ job.record_group.name }}</td>
				<td><a href="{% url 'job_details' org_id=job.record_group.organization.id record_group_id=job.record_group.id job_id=job.id %}">{{ job.name }}</a></td>
				<td>{{ job.record_count }}</td>
			</tr>
		{% endfor %}
	{% endfor %}

	<tr>
		<td></td>
		<td></td>
		<td><strong>Total:</strong></td>
		<td>{{ published.record_count }}</td>
	</tr>

</table>

<h2>Records</h2>

<p>Some notes on the table below:
	<ul>
		<li>The <code>Unique</code> column is from the originating job, and does not mean the record is unique amongst all published records</li>
	</ul>
</p>

<table id='published_records'>
	<thead>
		<th>ID</th>
		<th>Record ID</th>
		<th>Publish Set ID</th>
		<th>Harvested OAI set</th>
		<th>Unique</th>
		<th>Document</th>
	</thead>
	<tfoot>
		<th>ID</th>
		<th>Record ID</th>
		<th>Publish Set ID</th>
		<th>Harvested OAI set</th>
		<th>Unique</th>
		<th>Document</th>
	</tfoot>
	<tbody>
	</tbody>
</table>

<script>
	$(document).ready(function() {
	    var oTable = $('#published_records').dataTable({
	        "processing": true,
	        "serverSide": true,
	        "ajax": "{% url 'published_dt_json' %}",
	        "searchDelay": 1000,
	        "pageLength": 25
	    });
	});
</script>

<h2>Indexed Field Analysis</h2>

<p><a href="http://{{ APP_HOST }}:9200/published/_search" target="_blank">Published ElasticSearch index</a></p>

<table id="index_analysis" border="1">
	<thead>
		<tr>
			<th>Field Name</th>
			<th>Instances of Field</th>
			<th>Count of Distinct Values of Field</th>
			<th>Percentage of Field Values that are Unique</th>
			<th>Instance of Field in Total Indexed Records</th>
		</tr>
	</thead>
	<tfoot>
		<tr>
			<th>Field Name</th>
			<th>Instances of Field</th>
			<th>Count of Distinct Values of Field</th>
			<th>Percentage of Field Values that are Unique</th>
			<th>Instance of Field in Total Indexed Records</th>
		</tr>
	</tfoot>

	<tbody>
		{% for field in published.count_indexed_fields.fields %}
			<tr>
				<td><a href="#" target="_blank">{{ field.field_name }}</a></td>
				<td>{{ field.instances }}</td>
				<td>{{ field.distinct }}</td>
				<td style="background-color:rgba(0,200,0,{{ field.distinct_ratio }});">{{ field.distinct_ratio }}</td>
				<td style="background-color:rgba(0,200,0,{{ field.percentage_of_total_records }});">{{ field.percentage_of_total_records }}</td>
			</tr>
		{% endfor %}
	</tbody>

</table>
<script>
	$(document).ready(function() {
	    $('#index_analysis').DataTable({
	    	"pageLength": 100,
	    	"lengthMenu": [ 10, 25, 100, 500 ]
	    });
	} );
</script>

<h2>OAI Endpoint</h2>

<ul>
	<li><a href="{{ COMBINE_OAI_ENDPOINT }}?verb=Identify" target="_blank">Identify</a></li>
	<li><a href="{{ COMBINE_OAI_ENDPOINT }}?verb=ListIdentifiers" target="_blank">List Identifiers</a></li>
	<li><a href="{{ COMBINE_OAI_ENDPOINT }}?verb=ListRecords" target="_blank">List Records</a></li>
	<li><a href="{{ COMBINE_OAI_ENDPOINT }}?verb=ListSets" target="_blank">List Sets</a></li>
</ul>


{% endblock %}