{% extends 'core/base.html' %}

{% block content %}

	<div class="row">
		<div class="col-md-12">
			<h2>Search Records</h2>
			<p>This page allows <strong>full-text</strong> searching of all Records, across all Jobs, currently held in Combine.</p>
		</div>
	</div>

	<div class="row">
		<div class="col-md-12">
			<h4>Records</h4>

			<table id='search_results' class="table table-bordered table-hover"></table>

			<script>

				$(document).ready(function() {

					// get search string if present
			    	{% if search_params %}
				    	search_params = JSON.parse('{{ search_params|safe|escapejs }}')
				    	q = search_params.q;
				    {% else %}
				    	q = '';
			    	{% endif %}

			    	// build additional data to send dto DTElasticGeneric endpoint
			    	var data = {}

					// DataTable
				    table = $('#search_results').DataTable({
				        "processing": true,
				        "serverSide": true,
				        "ajax": {
				        	"url":"{% url 'records_es_generic_dt_json' %}",
				        	"data":data,
			        	},
				        "searchDelay": 1000,
				        "pageLength": 10,
				        "pagingType": "full_numbers",
				        "ordering":false,
				        "search": {
						    "search": q,
						    "smart": false
						},
				        "columns": [
				            {
				            	title: "DB ID",
				            	"render": function ( data, type, row ) {
				                    return "<a href='"+row[3]+"'>" + row[4] + "</a>";
				                }
			            	},
				            {
				            	title: "Combine ID",
				            	"render": function ( data, type, row ) {
				                    return "<a href='"+row[3]+"'>" + row[5] + "</a>";
				                }
			            	},
				            {
				            	title: "Record ID",
				            	"render": function ( data, type, row ) {
				                    return "<a href='"+row[3]+"'>" + row[6] + "</a>";
				                }
				            },
				            {
				            	title: "Organization",
				            	"render": function ( data, type, row ) {
				                    return row[0];
				                }
				            },
				            {
				            	title: "Record Group",
				            	"render": function ( data, type, row ) {
				                    return row[1];
				                }
				            },
				            {
				            	title: "Job",
				            	"render": function ( data, type, row ) {
				                    return row[2];
				                }
				            }
				        ]
				    });
				});





			</script>

		</div>
	</div>

{% endblock %}